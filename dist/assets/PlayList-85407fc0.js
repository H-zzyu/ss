import{G as x,P as u,o as P,q as I,K as i,I as g,S as y,Q as h,L as d,p as _,M as k,E as $,J as C,U as B}from"./index-ce652367.js";/* empty css                */import{u as p,a as v}from"./counter-3b57c71a.js";const T="/assets/下一首-dfa72a70.svg",S="/assets/播放2-e345550a.svg",L="/assets/暂停-9a94af61.svg";const A={data(){return{musicid:"",id:0,current:{},arIds:[519460354,"天行九歌（Cover 霍尊）","白止","https://p1.music.126.net/6y-UleORITEDbvrOLV0Q8A==/5639395138885805.jpg","【白止】天行九歌"],play:{},allmusic:[],stop:!1,currentTime:"0:00",duration:"0:00",play:"src/assets/music/天行九歌.mp3",percent:0,speed:0,state:p()}},mounted(){this.$Bus.on("rendoms",r=>{console.log(r),this.allmusic=r});const t=this.$refs.musicPlayer;t.addEventListener("timeupdate",()=>{const r=t.currentTime;this.currentTime=this.formatTime(r),Math.ceil(r/this.percent),this.$refs.progressBtn.style.left=Math.ceil(r/this.percent)+"%",this.$refs.progress.style.width=Math.ceil(r/this.percent)+"%"});var s=document.querySelectorAll("video");for(var a of s)a.addEventListener("pause",r=>{console.log("暂停播放"),this.playNextCommand()});setTimeout(()=>{this.MusicTime()},1100)},methods:{startTracking(t){this.tracking=!0,this.drag(e)},drag(t){const s=this.$refs.musicPlayer;let r=((t.x-this.$refs.progressBar.offsetLeft)/this.$refs.progressBar.clientWidth).toFixed(2);const n=parseInt(s.duration);s.currentTime=parseInt(n*r)},clicktime(t){const s=this.$refs.musicPlayer;let r=((t.x-this.$refs.progressBar.offsetLeft)/this.$refs.progressBar.clientWidth).toFixed(2);const n=parseInt(s.duration);s.currentTime=parseInt(n*r)},MusicTime(){const t=this.$refs.musicPlayer,s=t.currentTime,a=t.duration;this.percent=parseInt(a)/100,this.currentTime=this.formatTime(s),this.duration=this.formatTime(a)},formatTime(t){const s=Math.floor(t/60),a=Math.floor(t%60);return`${String(s).padStart(2,"0")}:${String(a).padStart(2,"0")}`},random(t,s){return Math.floor(Math.random()*(s-t+1))+t},playNextCommand(){const t=p();this.allmusic=t.$state.musics;const s=this.$refs.musicPlayer;if(s.duration==s.currentTime){const a=this.random(1,this.allmusic.length),r=this.allmusic[a];this.current=this.allmusic[a],this.arIds=[r.id,r.title,r.description,r.imageUrl,r.album],console.log(this.arIds),setTimeout(()=>{this.getMusicPlay()},110)}},next(t){const s=p();this.allmusic=s.$state.musics;var a=new Array(...this.allmusic);this.$refs.musicPlayer.pause(),this.stop=!1;var n=a.findIndex(c=>c.id==this.arIds[0]);let o=n+t;if(o>=this.allmusic.length)o=0;else if(o<0)o=this.allmusic.length,console.log(this.allmusic.length);else{const c=this.allmusic[o];this.arIds=[c.id,c.title,c.description,c.imageUrl,c.album],setTimeout(()=>{this.getMusicPlay()},110)}},getVidDur(){this.playNextCommand()},Collection(){const[t,s,a,r,n]=this.arIds,o={id:t,title:s,description:n,imageUrl:r,album:a};p().increment(o),this.postNodeSql()},postNodeSql(){const[t,s,a,r,n]=this.arIds,o={id:t,title:s,description:a,imageUrl:r,album:n};v.post("http://127.0.0.1:3000/musics",o,{headers:{"Content-Type":"application/json"}}).then(c=>{console.log(c.data)}).catch(c=>{console.error(c),this.$message.error("音乐数据发送失败")})},togglePlay(){this.stop=!this.stop;const t=this.$refs.musicPlayer;this.$refs.musicPlayer,t?this.stop?t.play():t.pause():this.$message.error("找不到音乐播放源")},getMusicPlay(){var t={method:"get",url:`/music/api/song/enhance/player/url/v1?encodeType=flac&ids=[${this.arIds[0]}]&level=lossless`};v(t).then(s=>{this.play=s.data.data[0].url,setTimeout(()=>{this.MusicTime()},2e3),setTimeout(()=>{this.$refs.musicPlayer.play(),s.data.data[0].url==null?(this.$message.error("vip歌曲，api不支持"),this.stop=!1):this.stop=!0},2e3)}).catch(function(s){this.$message.error("音乐播放失败，请刷新页面")})}},watch:{"state.$state.sendmusicmsg":{handler:function(t,s){this.arIds=t,this.getMusicPlay()}}},beforeUnmount(){this.$Bus.off("collection"),this.$Bus.off("rendoms")}},U={class:"music-start"},N={class:"music-start-stop"},V={class:"music-play-icon"},D={class:"music-previous-song play",src:S,alt:""},E={src:L,alt:"",class:"play"},q={class:"musci-detailed-all"},j={class:"music-name-new-jpg"},z=["src"],F={class:"musci-detailed"},K={class:"music-detailed-folderadd"},O={class:"musci-detailed-name"},R={class:"musci-time-name"},Q={class:"music-time-zreo"},W={class:"time-total"},G={class:"progress-bar-wrapper"},J={class:"bar-inner",ref:"progressBar"},H={class:"progress",ref:"progress"},X={class:"progress-btn-wrapper",ref:"progressBtn"},Y=["src"];function Z(t,s,a,r,n,o){const c=u("FolderAdd"),m=$;return P(),I("div",U,[i("div",N,[i("div",V,[i("img",{class:"music-previous-song next",onClick:s[0]||(s[0]=l=>o.next(-1)),src:T,alt:""}),i("div",{onClick:s[1]||(s[1]=(...l)=>o.togglePlay&&o.togglePlay(...l))},[g(i("img",D,null,512),[[y,!n.stop]]),g(i("img",E,null,512),[[y,n.stop]])]),i("img",{class:"next",onClick:s[2]||(s[2]=l=>o.next(1)),src:T,alt:""})]),i("div",q,[i("div",j,[i("img",{src:n.arIds[3],alt:""},null,8,z)]),i("div",F,[i("div",K,[i("span",O,h(n.arIds[1]),1),d(m,{class:"elicon folderadd",size:15,onClick:o.Collection},{default:_(()=>[d(c)]),_:1},8,["onClick"])]),i("span",R,[i("span",Q,h(n.currentTime),1),k(" "+h(n.arIds[2])+" ",1),i("span",W,h(n.duration),1)]),i("div",G,[i("div",{class:"progress-bar",onClick:s[5]||(s[5]=(...l)=>o.clicktime&&o.clicktime(...l))},[i("div",J,[i("div",H,null,512),i("div",X,[i("div",{class:"progress-btn",onMousedown:s[3]||(s[3]=(...l)=>o.startTracking&&o.startTracking(...l)),onMousemove:s[4]||(s[4]=(...l)=>o.drag&&o.drag(...l))},null,32)],512)],512)])])]),i("video",{ref:"musicPlayer",onCanplay:s[6]||(s[6]=l=>o.getVidDur()),src:n.play},null,40,Y)])])])}const ss=x(A,[["render",Z],["__scopeId","data-v-cd5363ea"]]);const ts={data(){return{music:{},text:""}},mounted(){},methods:{musciname(){this.$router.push("/musicsearch"),setTimeout(()=>{this.$Bus.emit("text",this.text)},500)}},beforeUnmount(){this.$Bus.off("text")}},es={class:"play-box"},is={class:"play"},rs={class:"music-seach"};function os(t,s,a,r,n,o){const c=u("ArrowLeft"),m=$,l=u("router-link"),M=u("ArrowRight"),w=u("router-view"),b=ss;return P(),I("div",es,[i("div",is,[i("div",rs,[d(l,{to:"/musicname",class:"router-link"},{default:_(()=>[d(m,{class:"elicon",size:25},{default:_(()=>[d(c)]),_:1})]),_:1}),d(m,{class:"elicon",size:25},{default:_(()=>[d(M)]),_:1}),g(i("input",{type:"text",class:"search-name","onUpdate:modelValue":s[0]||(s[0]=f=>n.text=f),onKeyup:s[1]||(s[1]=B((...f)=>o.musciname&&o.musciname(...f),["enter"]))},null,544),[[C,n.text]])]),d(w),d(b)])])}const ls=x(ts,[["render",os],["__scopeId","data-v-3bb33415"]]);export{ls as default};
